<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlanOrg - Event Planning Made Simple</title>
    <link rel="icon" type="image/png" href="logo.png">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Epilogue:wght@300;400;600;800&family=Space+Mono:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-tertiary: #94a3b8;
            --border-color: #e2e8f0;
            --card-bg: rgba(255, 255, 255, 0.8);
            --glass-bg: rgba(255, 255, 255, 0.8);
            --gradient-start: #4f46e5;
            --gradient-end: #7c3aed;
            --gradient-bg: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            --accent-light: rgba(79, 70, 229, 0.1);
            --shadow-color: rgba(79, 70, 229, 0.15);
        }

        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            --border-color: #334155;
            --card-bg: rgba(30, 41, 59, 0.8);
            --glass-bg: rgba(30, 41, 59, 0.8);
            --gradient-bg: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --accent-light: rgba(99, 102, 241, 0.2);
            --shadow-color: rgba(99, 102, 241, 0.25);
        }

        body {
            font-family: 'Epilogue', sans-serif;
            background: var(--gradient-bg);
            overflow-x: hidden;
            color: var(--text-primary);
            transition: background 0.3s ease, color 0.3s ease;
        }

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            transition: all 0.3s ease;
        }

        .btn-gradient {
            background: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
            transition: all 0.3s ease;
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-family: 'Epilogue', sans-serif;
        }

        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px var(--shadow-color);
        }

        .table-row-hover:hover {
            background: var(--accent-light);
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 10px; }

        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        .page.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Navigation */
        .navbar {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-color);
        }
        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-logo {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .nav-logo img {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }
        .nav-actions {
            display: flex;
            gap: 16px;
            align-items: center;
        }
        .btn-login {
            padding: 10px 20px;
            background: transparent;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            color: var(--text-primary);
            transition: all 0.3s ease;
            font-family: 'Epilogue', sans-serif;
        }
        .btn-login:hover {
            border-color: var(--gradient-start);
            color: var(--gradient-start);
        }

        /* Hero Section */
        .hero-section {
            max-width: 1400px;
            margin: 0 auto;
            padding: 100px 40px 60px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 80px;
            align-items: center;
        }
        .hero-content h1 {
            font-size: 64px;
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 24px;
            color: var(--text-primary);
        }
        .hero-content .highlight {
            background: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .hero-content p {
            font-size: 20px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 40px;
        }
        .hero-actions {
            display: flex;
            gap: 16px;
        }
        .btn-hero {
            padding: 16px 40px;
            font-size: 18px;
            border-radius: 10px;
        }
        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            padding: 14px 38px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Epilogue', sans-serif;
        }
        .btn-secondary:hover {
            border-color: var(--gradient-start);
            transform: translateY(-2px);
        }

        .hero-visual {
            position: relative;
        }
        .hero-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 20px 50px var(--shadow-color);
        }
        .hero-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        .hero-card-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }
        .hero-badge {
            background: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }
        .hero-event-item {
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 4px solid var(--gradient-start);
        }
        .hero-event-name {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        .hero-event-meta {
            display: flex;
            gap: 16px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Features Section */
        .features-section {
            max-width: 1400px;
            margin: 80px auto;
            padding: 0 40px;
        }
        .section-header {
            text-align: center;
            margin-bottom: 60px;
        }
        .section-header h2 {
            font-size: 48px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 16px;
        }
        .section-header p {
            font-size: 20px;
            color: var(--text-secondary);
        }
        .features-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 32px;
        }
        .feature-card {
            padding: 40px;
            text-align: left;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        .feature-card:hover {
            transform: translateY(-8px);
            border-color: var(--gradient-start);
        }
        .feature-icon {
            font-size: 56px;
            margin-bottom: 20px;
        }
        .feature-card h3 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-primary);
        }
        .feature-card p {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        /* CTA Section */
        .cta-section {
            max-width: 1400px;
            margin: 100px auto;
            padding: 0 40px;
        }
        .cta-box {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            border-radius: 24px;
            padding: 80px 60px;
            text-align: center;
            color: white;
        }
        .cta-box h2 {
            font-size: 48px;
            font-weight: 800;
            margin-bottom: 20px;
        }
        .cta-box p {
            font-size: 20px;
            margin-bottom: 40px;
            opacity: 0.9;
        }
        .btn-cta {
            background: white;
            color: var(--gradient-start);
            padding: 18px 48px;
            font-size: 18px;
            font-weight: 700;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Epilogue', sans-serif;
        }
        .btn-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        /* Auth Pages */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .auth-box {
            max-width: 440px;
            width: 100%;
            padding: 48px;
        }
        .auth-box h2 {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        .auth-box p {
            color: var(--text-secondary);
            margin-bottom: 32px;
        }
        .auth-tabs {
            display: flex;
            gap: 16px;
            margin-bottom: 32px;
            border-bottom: 2px solid var(--border-color);
        }
        .auth-tab {
            padding: 12px 24px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            position: relative;
            font-family: 'Epilogue', sans-serif;
            transition: color 0.3s ease;
        }
        .auth-tab.active {
            color: var(--gradient-start);
        }
        .auth-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
        }
        .input-group {
            margin-bottom: 20px;
        }
        .input-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        .input-group input, select, textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 15px;
            font-family: 'Epilogue', sans-serif;
            transition: all 0.3s ease;
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        .input-group input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--gradient-start);
            box-shadow: 0 0 0 3px var(--accent-light);
        }
        .divider {
            text-align: center;
            margin: 24px 0;
            position: relative;
        }
        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--border-color);
        }
        .divider span {
            background: var(--glass-bg);
            padding: 0 12px;
            position: relative;
            font-size: 14px;
            color: var(--text-secondary);
        }
        .google-btn {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border-color);
            background: var(--bg-primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Epilogue', sans-serif;
            color: var(--text-primary);
        }
        .google-btn:hover {
            border-color: var(--gradient-start);
            background: var(--bg-secondary);
        }

        /* Onboarding */
        .onboarding-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .onboarding-box {
            max-width: 560px;
            width: 100%;
            padding: 48px;
        }
        .progress-bar {
            height: 6px;
            background: var(--border-color);
            border-radius: 10px;
            margin-bottom: 40px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
            transition: width 0.5s ease;
        }
        .onboarding-step { display: none; }
        .onboarding-step.active { display: block; }
        .onboarding-box h2 {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 32px;
            color: var(--text-primary);
        }
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 32px;
        }
        .radio-option {
            padding: 16px 20px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--bg-primary);
        }
        .radio-option:hover {
            border-color: #c7d2fe;
            background: var(--bg-secondary);
        }
        .radio-option.selected {
            border-color: var(--gradient-start);
            background: var(--accent-light);
        }

        /* Dashboard */
        .dashboard {
            display: flex;
            min-height: 100vh;
        }
        .sidebar {
            width: 280px;
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border-right: 1px solid var(--border-color);
            padding: 24px;
            display: flex;
            flex-direction: column;
        }
        .sidebar-logo {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 40px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .sidebar-logo img {
            width: 32px;
            height: 32px;
            object-fit: contain;
        }
        .sidebar-nav { flex: 1; }
        .nav-item {
            padding: 14px 16px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            color: var(--text-secondary);
        }
        .nav-item:hover {
            background: var(--accent-light);
            color: var(--gradient-start);
        }
        .nav-item.active {
            background: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
            color: white;
        }
        .nav-item span { font-size: 20px; }
        .user-profile {
            padding: 16px;
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
        }
        .user-info h4 {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
        }
        .user-info p {
            font-size: 12px;
            color: var(--text-secondary);
        }
        .main-canvas {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            background: var(--bg-secondary);
        }
        .canvas-header { margin-bottom: 32px; }
        .canvas-header h1 {
            font-size: 36px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        .canvas-header p {
            font-size: 16px;
            color: var(--text-secondary);
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .action-bar {
            display: flex;
            gap: 16px;
            margin-bottom: 32px;
            flex-wrap: wrap;
            align-items: flex-end;
        }
        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }
        .search-box input {
            width: 100%;
            padding: 14px 16px 14px 44px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 15px;
            font-family: 'Epilogue', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        .search-box::before {
            content: 'üîç';
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
        }
        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 24px;
        }
        .event-card {
            padding: 24px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .event-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
        }
        .event-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px var(--shadow-color);
        }
        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }
        .event-header h3 {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }
        .event-meta {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 16px;
        }
        .event-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-secondary);
        }
        .event-footer {
            display: flex;
            gap: 8px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }
        .btn-small {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-family: 'Epilogue', sans-serif;
        }
        .btn-outline {
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            color: var(--text-secondary);
        }
        .btn-outline:hover {
            border-color: var(--gradient-start);
            color: var(--gradient-start);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal.active { display: flex; }
        .modal-content {
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 40px;
            position: relative;
        }
        .modal-header {
            margin-bottom: 32px;
        }
        .modal-header h2 {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
        }
        .close-modal {
            position: absolute;
            top: 20px; right: 20px;
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.3s ease;
            z-index: 1003;
        }
        .close-modal:hover { color: var(--text-primary); }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-grid.full { grid-template-columns: 1fr; }
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
        }

        /* Image Upload */
        .image-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 32px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-secondary);
        }
        .image-upload-area:hover {
            border-color: var(--gradient-start);
            background: var(--accent-light);
        }
        .upload-icon { font-size: 48px; margin-bottom: 12px; }
        .upload-text { font-size: 15px; color: var(--text-secondary); margin-bottom: 8px; }
        .upload-hint { font-size: 13px; color: var(--text-tertiary); }
        .image-preview { display: none; }
        .image-preview.active { display: block; }
        .preview-image {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
        }
        .image-actions { display: flex; gap: 8px; justify-content: center; }
        .btn-remove-image {
            padding: 8px 16px;
            background: #fee2e2;
            color: #dc2626;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Epilogue', sans-serif;
            font-size: 13px;
        }
        .btn-change-image {
            padding: 8px 16px;
            background: #e0e7ff;
            color: var(--gradient-start);
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Epilogue', sans-serif;
            font-size: 13px;
        }
        .event-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 16px;
        }
        .invitation-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 24px;
        }

        /* Autocomplete */
        .autocomplete-container { position: relative; }
        .autocomplete-dropdown {
            position: absolute;
            top: 100%; left: 0; right: 0;
            background: var(--bg-primary);
            border: 2px solid var(--gradient-start);
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1002;
            box-shadow: 0 10px 25px var(--shadow-color);
            display: none;
        }
        .autocomplete-dropdown.active { display: block; }
        .autocomplete-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: start;
            gap: 12px;
        }
        .autocomplete-item:hover { background: var(--accent-light); }
        .autocomplete-name { font-weight: 600; color: var(--text-primary); font-size: 14px; }
        .autocomplete-address { font-size: 13px; color: var(--text-secondary); }

        /* Budget */
        .budget-summary { padding: 24px; margin-bottom: 32px; }
        .budget-summary h3 { font-size: 20px; font-weight: 700; margin-bottom: 20px; }
        .budget-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .budget-stat { text-align: center; }
        .budget-stat-value { font-size: 32px; font-weight: 800; margin-bottom: 4px; }
        .budget-stat-value.positive { color: #10b981; }
        .budget-stat-value.negative { color: #ef4444; }
        .budget-stat-value.neutral { color: var(--gradient-start); }
        .budget-stat-label { font-size: 14px; color: var(--text-secondary); font-weight: 600; }
        .expenses-table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
        .expenses-table th {
            text-align: left;
            padding: 12px 16px;
            font-size: 13px;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
        }
        .expenses-table td {
            padding: 16px;
            background: var(--card-bg);
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
        }
        .expenses-table tr td:first-child {
            border-left: 1px solid var(--border-color);
            border-radius: 8px 0 0 8px;
        }
        .expenses-table tr td:last-child {
            border-right: 1px solid var(--border-color);
            border-radius: 0 8px 8px 0;
        }

        /* Guest List Styles */
        .mode-toggle {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            background: var(--bg-primary);
            padding: 4px;
            border-radius: 8px;
            border: 2px solid var(--border-color);
            width: fit-content;
        }
        .mode-btn {
            padding: 10px 24px;
            border: none;
            background: transparent;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
            font-family: 'Epilogue', sans-serif;
        }
        .mode-btn.active {
            background: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
            color: white;
        }
        .guest-mode { display: none; }
        .guest-mode.active { display: block; }
        
        .guests-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
        }
        .guests-table th {
            text-align: left;
            padding: 12px 16px;
            font-size: 13px;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
        }
        .guests-table td {
            padding: 16px;
            background: var(--card-bg);
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
        }
        .guests-table tr td:first-child {
            border-left: 1px solid var(--border-color);
            border-radius: 8px 0 0 8px;
        }
        .guests-table tr td:last-child {
            border-right: 1px solid var(--border-color);
            border-radius: 0 8px 8px 0;
        }

        .spreadsheet-container {
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .spreadsheet-grid {
            overflow-x: auto;
        }
        .spreadsheet-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }
        .spreadsheet-table th {
            background: var(--bg-secondary);
            padding: 12px;
            text-align: left;
            font-weight: 700;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        .spreadsheet-table td {
            padding: 0;
            border: 1px solid var(--border-color);
        }
        .spreadsheet-table input {
            width: 100%;
            padding: 12px;
            border: none;
            background: transparent;
            font-family: 'Epilogue', sans-serif;
            color: var(--text-primary);
        }
        .spreadsheet-table input:focus {
            outline: 2px solid var(--gradient-start);
            background: var(--accent-light);
        }
        .spreadsheet-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .empty-state { text-align: center; padding: 80px 20px; }
        .empty-state-icon { font-size: 64px; margin-bottom: 20px; opacity: 0.5; }
        .empty-state h3 { font-size: 20px; font-weight: 700; color: var(--text-primary); margin-bottom: 8px; }
        .empty-state p { color: var(--text-secondary); margin-bottom: 24px; }

        .invitation-box { padding: 24px; margin-top: 24px; border: 2px dashed #c7d2fe; border-radius: 12px; }
        .invitation-box h4 { font-size: 16px; font-weight: 700; margin-bottom: 12px; }
        .invitation-link { display: flex; gap: 12px; align-items: center; }
        .invitation-link input {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Space Mono', monospace;
            background: var(--bg-secondary);
        }
        .btn-copy {
            padding: 12px 20px;
            background: var(--gradient-start);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Epilogue', sans-serif;
        }
        .logout-btn {
            width: 100%;
            padding: 12px;
            background: #fee2e2;
            color: #dc2626;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 16px;
            font-family: 'Epilogue', sans-serif;
        }

        /* Settings */
        .settings-section { max-width: 800px; }
        .settings-card {
            padding: 32px;
            margin-bottom: 24px;
        }
        .settings-card h3 {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .theme-toggle {
            display: flex;
            gap: 12px;
        }
        .theme-btn {
            flex: 1;
            padding: 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
            cursor: pointer;
            font-family: 'Epilogue', sans-serif;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .theme-btn:hover {
            border-color: var(--gradient-start);
        }
        .theme-btn.active {
            border-color: var(--gradient-start);
            background: var(--accent-light);
            color: var(--gradient-start);
        }
        .error-message, .success-message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
            display: none;
        }
        .error-message {
            background: #fee2e2;
            color: #dc2626;
        }
        .success-message {
            background: #d1fae5;
            color: #065f46;
        }
        .error-message.show, .success-message.show {
            display: block;
        }

        .map-link-helper {
            margin-top: 8px;
            padding: 12px;
            background: var(--accent-light);
            border-left: 3px solid var(--gradient-start);
            border-radius: 6px;
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .invite-loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        .spinner {
            width: 40px; height: 40px;
            border: 4px solid var(--border-color);
            border-top-color: var(--gradient-start);
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        @media (max-width: 1024px) {
            .hero-section {
                grid-template-columns: 1fr;
                gap: 60px;
                padding: 60px 20px;
            }
            .hero-content h1 {
                font-size: 48px;
            }
            .features-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .dashboard { flex-direction: column; }
            .sidebar { width: 100%; border-right: none; border-bottom: 1px solid var(--border-color); }
            .main-canvas { padding: 20px; }
            .form-grid { grid-template-columns: 1fr; }
            .hero-content h1 { font-size: 36px; }
            .section-header h2 { font-size: 36px; }
        }
    </style>
</head>
<body>

<!-- Home Page -->
<div id="homePage" class="page active">
    <div class="home-page">
        <nav class="navbar">
            <div class="nav-content">
                <div class="nav-logo">
                    <img src="logo.png" alt="PlanOrg Logo">
                    <span>PlanOrg</span>
                </div>
                <div class="nav-actions">
                    <button class="btn-login" onclick="showPage('authPage')">Log In</button>
                    <button class="btn-gradient" onclick="showPage('authPage')">Get Started</button>
                </div>
            </div>
        </nav>

        <section class="hero-section">
            <div class="hero-content">
                <h1><span class="highlight">Smarter</span> event planning for everyone</h1>
                <p>Create, manage, and share events effortlessly. Track budgets, coordinate guests, and make every event memorable with PlanOrg.</p>
                <div class="hero-actions">
                    <button class="btn-gradient btn-hero" onclick="showPage('authPage')">Start For Free</button>
                    <button class="btn-secondary btn-hero" onclick="scrollToFeatures()">Learn More</button>
                </div>
            </div>
            <div class="hero-visual">
                <div class="hero-card">
                    <div class="hero-card-header">
                        <div class="hero-card-title">Your Events</div>
                        <div class="hero-badge">3 Active</div>
                    </div>
                    <div class="hero-event-item">
                        <div class="hero-event-name">Summer Conference 2026</div>
                        <div class="hero-event-meta"><span>üìÖ Jun 15, 2026</span><span>üë• 200 guests</span></div>
                    </div>
                    <div class="hero-event-item">
                        <div class="hero-event-name">Team Building Workshop</div>
                        <div class="hero-event-meta"><span>üìÖ Feb 28, 2026</span><span>üë• 50 guests</span></div>
                    </div>
                    <div class="hero-event-item">
                        <div class="hero-event-name">Annual Gala Dinner</div>
                        <div class="hero-event-meta"><span>üìÖ Dec 10, 2026</span><span>üë• 150 guests</span></div>
                    </div>
                </div>
            </div>
        </section>

        <section class="features-section" id="featuresSection">
            <div class="section-header">
                <h2>Everything you need to plan perfect events</h2>
                <p>Powerful features that make event planning simple and efficient</p>
            </div>
            <div class="features-grid">
                <div class="feature-card glass-card">
                    <div class="feature-icon">üìÖ</div>
                    <h3>Smart Planning</h3>
                    <p>Create and manage events with ease. Track dates, venues, and guests all in one intuitive dashboard.</p>
                </div>
                <div class="feature-card glass-card">
                    <div class="feature-icon">üí∞</div>
                    <h3>Budget Tracking</h3>
                    <p>Monitor expenses in real-time and stay on budget with detailed financial insights and reporting.</p>
                </div>
                <div class="feature-card glass-card">
                    <div class="feature-icon">üîó</div>
                    <h3>Easy Sharing</h3>
                    <p>Generate beautiful invitation links instantly and share with guests effortlessly via any platform.</p>
                </div>
                <div class="feature-card glass-card">
                    <div class="feature-icon">üìç</div>
                    <h3>Location Management</h3>
                    <p>Integrated Google Maps support ensures guests never get lost finding your event venue.</p>
                </div>
                <div class="feature-card glass-card">
                    <div class="feature-icon">üë•</div>
                    <h3>Guest Management</h3>
                    <p>Add guests individually or import them in bulk with our built-in spreadsheet feature.</p>
                </div>
                <div class="feature-card glass-card">
                    <div class="feature-icon">‚ö°</div>
                    <h3>Real-time Updates</h3>
                    <p>All changes sync instantly across devices, keeping everyone on the same page automatically.</p>
                </div>
            </div>
        </section>

        <section class="cta-section">
            <div class="cta-box">
                <h2>Ready to plan your next event?</h2>
                <p>Join thousands of event planners who trust PlanOrg</p>
                <button class="btn-cta" onclick="showPage('authPage')">Get Started For Free</button>
            </div>
        </section>
    </div>
</div>

<!-- Auth Page -->
<div id="authPage" class="page">
    <div class="auth-container">
        <div class="auth-box glass-card">
            <h2>Welcome to PlanOrg</h2>
            <p>Create an account or sign in to continue</p>
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('signup', this)">Sign Up</button>
                <button class="auth-tab" onclick="switchAuthTab('login', this)">Login</button>
            </div>
            <button class="google-btn" onclick="signInWithGoogle()">
                <svg width="20" height="20" viewBox="0 0 20 20">
                    <path fill="#4285F4" d="M19.6 10.23c0-.82-.1-1.42-.25-2.05H10v3.72h5.5c-.15.96-.74 2.31-2.04 3.22v2.45h3.16c1.89-1.73 2.98-4.3 2.98-7.34z"/>
                    <path fill="#34A853" d="M13.46 15.13c-.83.59-1.96 1-3.46 1-2.64 0-4.88-1.74-5.68-4.15H1.07v2.52C2.72 17.75 6.09 20 10 20c2.7 0 4.96-.89 6.62-2.42l-3.16-2.45z"/>
                    <path fill="#FBBC05" d="M3.99 10c0-.69.12-1.35.32-1.97V5.51H1.07A9.973 9.973 0 000 10c0 1.61.39 3.14 1.07 4.49l3.24-2.52c-.2-.62-.32-1.28-.32-1.97z"/>
                    <path fill="#EA4335" d="M10 3.88c1.88 0 3.13.81 3.85 1.48l2.84-2.76C14.96.99 12.7 0 10 0 6.09 0 2.72 2.25 1.07 5.51l3.24 2.52C5.12 5.62 7.36 3.88 10 3.88z"/>
                </svg>
                Continue with Google
            </button>
            <div class="divider"><span>or</span></div>
            <div id="signupForm" class="auth-form">
                <div class="input-group"><label>Email</label><input type="email" id="signupEmail" placeholder="you@example.com"></div>
                <div class="input-group"><label>Password</label><input type="password" id="signupPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
                <button class="btn-gradient" onclick="signUpWithEmail()" style="width: 100%; margin-top: 8px;">Create Account</button>
            </div>
            <div id="loginForm" class="auth-form" style="display: none;">
                <div class="input-group"><label>Email</label><input type="email" id="loginEmail" placeholder="you@example.com"></div>
                <div class="input-group"><label>Password</label><input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
                <button class="btn-gradient" onclick="loginWithEmail()" style="width: 100%; margin-top: 8px;">Sign In</button>
            </div>
        </div>
    </div>
</div>

<!-- Onboarding Page -->
<div id="onboardingPage" class="page">
    <div class="onboarding-container">
        <div class="onboarding-box glass-card">
            <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width: 50%;"></div></div>
            <div id="onboardingStep1" class="onboarding-step active">
                <h2>How did you hear about PlanOrg?</h2>
                <div class="radio-group">
                    <label class="radio-option" onclick="selectRadio(this, 'source')"><input type="radio" name="source" value="search"><span>Search Engine</span></label>
                    <label class="radio-option" onclick="selectRadio(this, 'source')"><input type="radio" name="source" value="social"><span>Social Media</span></label>
                    <label class="radio-option" onclick="selectRadio(this, 'source')"><input type="radio" name="source" value="friend"><span>Friend or Colleague</span></label>
                    <label class="radio-option" onclick="selectRadio(this, 'source')"><input type="radio" name="source" value="ad"><span>Advertisement</span></label>
                    <label class="radio-option" onclick="selectRadio(this, 'source')"><input type="radio" name="source" value="other"><span>Other</span></label>
                </div>
                <button class="btn-gradient" onclick="nextOnboardingStep()" style="width: 100%;">Continue</button>
            </div>
            <div id="onboardingStep2" class="onboarding-step">
                <h2>Let's personalize your account</h2>
                <div class="input-group"><label>Username (unique handle)</label><input type="text" id="username" placeholder="johndoe"></div>
                <div class="input-group"><label>Display Name</label><input type="text" id="displayName" placeholder="John Doe"></div>
                <button class="btn-gradient" onclick="completeOnboarding()" style="width: 100%;">Get Started</button>
            </div>
        </div>
    </div>
</div>

<!-- Invitation Page -->
<div id="invitationPage" class="page">
    <div class="auth-container">
        <div class="auth-box glass-card" style="max-width: 600px;">
            <div style="text-align: center; margin-bottom: 32px;">
                <div class="sidebar-logo" style="margin-bottom: 20px; justify-content: center;">
                    <img src="logo.png" alt="PlanOrg Logo">
                    <span>PlanOrg</span>
                </div>
                <h2 style="margin-bottom: 8px;">You're Invited!</h2>
                <p style="color: var(--text-secondary);">View event details below</p>
            </div>
            <div id="invitationContent">
                <div class="invite-loading"><div class="spinner"></div>Loading event details...</div>
            </div>
            <div style="margin-top: 32px; padding-top: 24px; border-top: 1px solid var(--border-color); text-align: center;">
                <p style="color: var(--text-secondary); margin-bottom: 16px; font-size: 14px;">Want to create your own events?</p>
                <button class="btn-gradient" onclick="showPage('authPage')" style="width: 100%;">Sign Up for PlanOrg</button>
            </div>
        </div>
    </div>
</div>

<!-- Dashboard -->
<div id="dashboardPage" class="page">
    <div class="dashboard">
        <div class="sidebar">
            <div class="sidebar-logo">
                <img src="logo.png" alt="PlanOrg Logo">
                <span>PlanOrg</span>
            </div>
            <div class="sidebar-nav">
                <div class="nav-item active" onclick="switchTab('events', this)"><span>üìÖ</span><span>Events</span></div>
                <div class="nav-item" onclick="switchTab('guests', this)"><span>üë•</span><span>Guest List</span></div>
                <div class="nav-item" onclick="switchTab('budget', this)"><span>üí∞</span><span>Budget & Expenses</span></div>
                <div class="nav-item" onclick="switchTab('settings', this)"><span>‚öôÔ∏è</span><span>Settings</span></div>
            </div>
            <div class="user-profile">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-info">
                    <h4 id="userDisplayName">User</h4>
                    <p id="userUsername">@user</p>
                </div>
            </div>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
        <div class="main-canvas">
            <!-- Events Tab -->
            <div id="eventsTab" class="tab-content active">
                <div class="canvas-header"><h1>Your Events</h1><p>Manage all your upcoming events in one place</p></div>
                <div class="action-bar">
                    <div class="search-box"><input type="text" placeholder="Search events..." id="searchEvents" oninput="searchEvents()"></div>
                    <button class="btn-gradient" onclick="openModal('eventModal')">+ Add Event</button>
                </div>
                <div class="events-grid" id="eventsGrid"></div>
                <div id="emptyEventsState" class="empty-state">
                    <div class="empty-state-icon">üìÖ</div>
                    <h3>No Events Yet</h3>
                    <p>Create your first event to get started</p>
                    <button class="btn-gradient" onclick="openModal('eventModal')">Create Event</button>
                </div>
            </div>

            <!-- Guest List Tab -->
            <div id="guestsTab" class="tab-content">
                <div class="canvas-header"><h1>Guest List</h1><p>Manage your event guests</p></div>
                <div class="action-bar">
                    <div class="input-group" style="margin: 0; flex: 1; max-width: 300px;">
                        <label>Select Event</label>
                        <select id="guestEventSelect" onchange="loadGuestList()"><option value="">Choose an event...</option></select>
                    </div>
                    <div class="mode-toggle">
                        <button class="mode-btn active" onclick="switchGuestMode('oneByOne', this)">One by One</button>
                        <button class="mode-btn" onclick="switchGuestMode('spreadsheet', this)">Spreadsheet</button>
                    </div>
                </div>
                <div id="guestContent" style="display: none;">
                    <!-- One by One Mode -->
                    <div id="oneByOneMode" class="guest-mode active">
                        <div class="glass-card" style="padding: 24px; margin-bottom: 24px;">
                            <button class="btn-gradient" onclick="openModal('guestModal')">+ Add Guest</button>
                        </div>
                        <div class="glass-card" style="padding: 24px;">
                            <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 20px;">Guests</h3>
                            <table class="guests-table">
                                <thead><tr><th>Name</th><th>Email</th><th>Phone</th><th>RSVP</th><th>Actions</th></tr></thead>
                                <tbody id="guestsTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                    <!-- Spreadsheet Mode -->
                    <div id="spreadsheetMode" class="guest-mode">
                        <div class="spreadsheet-container">
                            <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 16px;">Import Guests</h3>
                            <p style="color: var(--text-secondary); margin-bottom: 16px; font-size: 14px;">Fill in the table below and click "Import All Guests" to add multiple guests at once.</p>
                            <div class="spreadsheet-grid">
                                <table class="spreadsheet-table" id="spreadsheetTable">
                                    <thead>
                                        <tr>
                                            <th style="width: 30%;">Name</th>
                                            <th style="width: 30%;">Email</th>
                                            <th style="width: 25%;">Phone</th>
                                            <th style="width: 15%;">RSVP</th>
                                        </tr>
                                    </thead>
                                    <tbody id="spreadsheetBody">
                                        <!-- Rows will be added dynamically -->
                                    </tbody>
                                </table>
                            </div>
                            <div class="spreadsheet-actions">
                                <button class="btn-gradient" onclick="importSpreadsheetGuests()">Import All Guests</button>
                                <button class="btn-outline btn-small" onclick="addSpreadsheetRow()">+ Add Row</button>
                                <button class="btn-outline btn-small" onclick="clearSpreadsheet()">Clear All</button>
                            </div>
                        </div>
                        <div class="glass-card" style="padding: 24px; margin-top: 24px;">
                            <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 20px;">Current Guests</h3>
                            <table class="guests-table">
                                <thead><tr><th>Name</th><th>Email</th><th>Phone</th><th>RSVP</th><th>Actions</th></tr></thead>
                                <tbody id="spreadsheetGuestsTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div id="emptyGuestState" class="empty-state">
                    <div class="empty-state-icon">üë•</div>
                    <h3>Select an Event</h3>
                    <p>Choose an event to manage its guest list</p>
                </div>
            </div>

            <!-- Budget Tab -->
            <div id="budgetTab" class="tab-content">
                <div class="canvas-header"><h1>Budget & Expenses</h1><p>Track your spending and stay on budget</p></div>
                <div class="action-bar">
                    <div class="input-group" style="margin: 0; flex: 1; max-width: 300px;">
                        <label>Select Event</label>
                        <select id="budgetEventSelect" onchange="loadBudgetData()"><option value="">Choose an event...</option></select>
                    </div>
                    <button class="btn-gradient" onclick="openModal('expenseModal')">+ Add Expense</button>
                    <button class="btn-outline btn-small" onclick="openModal('setBudgetModal')" style="padding: 10px 18px;">Set Budget</button>
                </div>
                <div id="budgetContent" style="display: none;">
                    <div class="budget-summary glass-card">
                        <h3>Budget Overview</h3>
                        <div class="budget-stats">
                            <div class="budget-stat"><div class="budget-stat-value neutral" id="totalBudget">$0</div><div class="budget-stat-label">Total Budget</div></div>
                            <div class="budget-stat"><div class="budget-stat-value neutral" id="totalExpenses">$0</div><div class="budget-stat-label">Total Expenses</div></div>
                            <div class="budget-stat"><div class="budget-stat-value neutral" id="remaining">$0</div><div class="budget-stat-label">Remaining</div></div>
                        </div>
                    </div>
                    <div class="glass-card" style="padding: 24px;">
                        <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 20px;">Expenses</h3>
                        <table class="expenses-table">
                            <thead><tr><th>Name</th><th>Category</th><th>Amount</th><th>Price</th><th>Total</th><th>Actions</th></tr></thead>
                            <tbody id="expensesTableBody"></tbody>
                        </table>
                    </div>
                </div>
                <div id="emptyBudgetState" class="empty-state">
                    <div class="empty-state-icon">üí∞</div>
                    <h3>Select an Event</h3>
                    <p>Choose an event to view and manage its budget</p>
                </div>
            </div>
            <!-- Settings Tab -->
            <div id="settingsTab" class="tab-content">
                <div class="canvas-header"><h1>Settings</h1><p>Manage your account preferences</p></div>
                <div class="settings-section">
                    <div class="settings-card glass-card">
                        <h3><span>üë§</span> Profile Information</h3>
                        <div id="settingsError" class="error-message"></div>
                        <div id="settingsSuccess" class="success-message"></div>
                        <div class="input-group">
                            <label>Username (unique handle)</label>
                            <input type="text" id="settingsUsername" placeholder="johndoe">
                            <p style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">Your unique identifier - cannot be the same as another user</p>
                        </div>
                        <div class="input-group">
                            <label>Display Name</label>
                            <input type="text" id="settingsDisplayName" placeholder="John Doe">
                        </div>
                        <button class="btn-gradient" onclick="updateProfile()">Save Changes</button>
                    </div>
                    <div class="settings-card glass-card">
                        <h3><span>üé®</span> Appearance</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 20px;">Choose your preferred theme</p>
                        <div class="theme-toggle">
                            <button class="theme-btn active" id="lightThemeBtn" onclick="setTheme('light')">
                                <span>‚òÄÔ∏è</span>
                                <span>Light Mode</span>
                            </button>
                            <button class="theme-btn" id="darkThemeBtn" onclick="setTheme('dark')">
                                <span>üåô</span>
                                <span>Dark Mode</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Event Modal -->
<div id="eventModal" class="modal">
    <div class="modal-content glass-card">
        <button class="close-modal" onclick="closeModal('eventModal')">√ó</button>
        <div class="modal-header"><h2 id="eventModalTitle">Create Event</h2></div>
        <form id="eventForm" onsubmit="saveEvent(event)">
            <div class="form-grid full">
                <div class="input-group">
                    <label>Event Image (Optional)</label>
                    <div class="image-upload-container">
                        <input type="file" id="eventImageInput" accept="image/*" style="display: none;" onchange="handleImageSelect(event)">
                        <div id="uploadArea" class="image-upload-area" onclick="document.getElementById('eventImageInput').click()">
                            <div class="upload-icon">üñºÔ∏è</div>
                            <div class="upload-text">Click to upload an event image (if it does not upload, the image size is to big)</div>
                            <div class="upload-hint">PNG, JPG up to 1MB</div>
                        </div>
                        <div id="imagePreview" class="image-preview">
                            <img id="previewImg" class="preview-image" src="" alt="Event preview">
                            <div class="image-actions">
                                <button type="button" class="btn-change-image" onclick="document.getElementById('eventImageInput').click()">Change</button>
                                <button type="button" class="btn-remove-image" onclick="removeImage()">Remove</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-grid">
                <div class="input-group"><label>Event Name *</label><input type="text" id="eventName" required></div>
                <div class="input-group"><label>Date *</label><input type="date" id="eventDate" required></div>
            </div>
            <div class="form-grid">
                <div class="input-group"><label>Time *</label><input type="time" id="eventTime" required></div>
                <div class="input-group">
                    <label>Number of Guests (Private)</label>
                    <input type="text" id="eventGuests" placeholder="e.g., 50 or Unknown">
                    <p style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">üîí For your reference only ‚Äî not visible to invitees</p>
                </div>
            </div>
            <div class="form-grid full">
                <div class="input-group autocomplete-container">
                    <label>Venue Address</label>
                    <input type="text" id="eventVenue" placeholder="Enter venue address" autocomplete="off">
                    <div id="venueAutocomplete" class="autocomplete-dropdown"></div>
                </div>
            </div>
            <div class="form-grid full">
                <div class="input-group">
                    <label>üìç Google Maps Link (For Accurate Location)</label>
                    <input type="url" id="eventMapLink" placeholder="Paste Google Maps share link here..." autocomplete="off">
                    <div class="map-link-helper">
                        <strong>üí° For best accuracy:</strong><br>
                        1. Open <strong>Google Maps</strong> app or website<br>
                        2. Search and select your exact location<br>
                        3. Tap/Click <strong>Share</strong> ‚Üí Copy link<br>
                        4. Paste here (e.g., <code>https://maps.app.goo.gl/...</code>)<br><br>
                        <em>This ensures guests get the exact location, not just an approximate address.</em>
                    </div>
                </div>
            </div>
            <div class="form-grid full">
                <div class="input-group">
                    <label>Event Description</label>
                    <textarea id="eventDescription" placeholder="Add event details that guests will see in the invitation..."></textarea>
                    <p style="font-size: 12px; color: var(--text-secondary); margin-top: 6px;">üëÄ <strong>Note:</strong> This description will be visible to everyone you share the invitation with.</p>
                </div>
            </div>
            <input type="hidden" id="eventId">
            <button type="submit" class="btn-gradient" style="width: 100%;" id="saveEventBtn">Save Event</button>
        </form>
        <div id="eventInvitation" class="invitation-box" style="display: none;">
            <h4>üì© Invitation Link</h4>
            <div class="invitation-link">
                <input type="text" id="invitationLink" readonly>
                <button type="button" class="btn-copy" onclick="copyInvitation(this)">Copy</button>
            </div>
        </div>
    </div>
</div>

<!-- Guest Modal -->
<div id="guestModal" class="modal">
    <div class="modal-content glass-card">
        <button class="close-modal" onclick="closeModal('guestModal')">√ó</button>
        <div class="modal-header"><h2>Add Guest</h2></div>
        <form onsubmit="saveGuest(event)">
            <div class="form-grid">
                <div class="input-group"><label>Name *</label><input type="text" id="guestName" required></div>
                <div class="input-group"><label>Email</label><input type="email" id="guestEmail" placeholder="Optional"></div>
            </div>
            <div class="form-grid">
                <div class="input-group"><label>Phone</label><input type="tel" id="guestPhone" placeholder="Optional"></div>
                <div class="input-group">
                    <label>RSVP Status</label>
                    <select id="guestRSVP">
                        <option value="Pending">Pending</option>
                        <option value="Confirmed">Confirmed</option>
                        <option value="Declined">Declined</option>
                    </select>
                </div>
            </div>
            <button type="submit" class="btn-gradient" style="width: 100%;">Add Guest</button>
        </form>
    </div>
</div>

<!-- Expense Modal -->
<div id="expenseModal" class="modal">
    <div class="modal-content glass-card">
        <button class="close-modal" onclick="closeModal('expenseModal')">√ó</button>
        <div class="modal-header"><h2>Add Expense</h2></div>
        <form onsubmit="saveExpense(event)">
            <div class="form-grid full">
                <div class="input-group"><label>Event *</label><select id="expenseEventSelect" required><option value="">Select an event...</option></select></div>
            </div>
            <div class="form-grid">
                <div class="input-group"><label>Expense Name *</label><input type="text" id="expenseName" required></div>
                <div class="input-group"><label>Category</label><input type="text" id="expenseCategory" placeholder="Optional"></div>
            </div>
            <div class="form-grid">
                <div class="input-group"><label>Amount *</label><input type="number" id="expenseAmount" min="0" step="0.01" required></div>
                <div class="input-group"><label>Price per Unit *</label><input type="number" id="expensePrice" min="0" step="0.01" required></div>
            </div>
            <div class="checkbox-group"><input type="checkbox" id="pricePerUnit"><label>Calculate as price per unit</label></div>
            <div class="form-grid full">
                <div class="input-group"><label>Budget for this Expense</label><input type="number" id="expenseBudget" min="0" step="0.01" placeholder="Optional"></div>
            </div>
            <input type="hidden" id="expenseId">
            <button type="submit" class="btn-gradient" style="width: 100%;">Save Expense</button>
        </form>
    </div>
</div>

<!-- Set Budget Modal -->
<div id="setBudgetModal" class="modal">
    <div class="modal-content glass-card">
        <button class="close-modal" onclick="closeModal('setBudgetModal')">√ó</button>
        <div class="modal-header"><h2>Set Event Budget</h2></div>
        <form onsubmit="setEventBudget(event)">
            <div class="input-group"><label>Total Budget *</label><input type="number" id="eventBudgetAmount" min="0" step="0.01" required></div>
            <button type="submit" class="btn-gradient" style="width: 100%;">Set Budget</button>
        </form>
    </div>
</div>

<script>
window.showPage = function(pageId) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
};

function scrollToFeatures() {
    document.getElementById('featuresSection').scrollIntoView({ behavior: 'smooth' });
}
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut, sendEmailVerification } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore, collection, doc, setDoc, getDoc, getDocs, updateDoc, deleteDoc, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";

const firebaseConfig = {
    apiKey: "AIzaSyDSZOld7SgkfXCvUZQhP56iBinUwu1lr5Y",
    authDomain: "planorgofficial.firebaseapp.com",
    projectId: "planorgofficial",
    storageBucket: "planorgofficial.firebasestorage.app",
    messagingSenderId: "838585284459",
    appId: "1:838585284459:web:733fa3eab0ab6db0993e2e",
    measurementId: "G-9RNBFB66V6"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const auth = getAuth(app);
const db = getFirestore(app);
const googleProvider = new GoogleAuthProvider();

window.auth = auth;
window.db = db;
window.googleProvider = googleProvider;
window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
window.signInWithEmailAndPassword = signInWithEmailAndPassword;
window.signInWithPopup = signInWithPopup;
window.signOut = signOut;
window.sendEmailVerification = sendEmailVerification;
window.firestoreDoc = doc;
window.firestoreSetDoc = setDoc;
window.firestoreGetDoc = getDoc;
window.firestoreGetDocs = getDocs;
window.firestoreUpdateDoc = updateDoc;
window.firestoreDeleteDoc = deleteDoc;
window.firestoreCollection = collection;
window.firestoreQuery = query;
window.firestoreWhere = where;
window.firestoreOnSnapshot = onSnapshot;

// Initialize theme
const savedTheme = localStorage.getItem('theme') || 'light';
document.documentElement.setAttribute('data-theme', savedTheme);
if (savedTheme === 'dark') {
    document.getElementById('lightThemeBtn')?.classList.remove('active');
    document.getElementById('darkThemeBtn')?.classList.add('active');
}

onAuthStateChanged(auth, async (user) => {
    if (user) {
        window.currentUser = user;
        try {
            const userDoc = await window.firestoreGetDoc(window.firestoreDoc(window.db, 'users', user.uid));
            if (!userDoc.exists() || !userDoc.data().username) {
                showPage('onboardingPage');
            } else {
                await loadUserData();
                showPage('dashboardPage');
            }
        } catch (error) {
            console.error('Error loading user data:', error);
            showPage('onboardingPage');
        }
    } else {
        window.currentUser = null;
        window.dispatchEvent(new CustomEvent('auth-ready-no-user'));
    }
});

window.loadInvitation = async function(eventId) {
    showPage('invitationPage');
    document.getElementById('invitationContent').innerHTML = '<div class="invite-loading"><div class="spinner"></div>Loading event details...</div>';
    try {
        const eventDoc = await window.firestoreGetDoc(window.firestoreDoc(window.db, 'events', eventId));
        if (!eventDoc.exists()) {
            document.getElementById('invitationContent').innerHTML = `
                <div class="empty-state" style="padding: 40px 20px;">
                    <div class="empty-state-icon">üòï</div>
                    <h3>Event Not Found</h3>
                    <p>This invitation link may be invalid or the event may have been deleted.</p>
                </div>`;
            return;
        }
        const evt = { id: eventDoc.id, ...eventDoc.data() };
        window.renderInvitation(evt);
    } catch (error) {
        console.error('Error loading invitation:', error);
        document.getElementById('invitationContent').innerHTML = `
            <div class="empty-state" style="padding: 40px 20px;">
                <div class="empty-state-icon">üòï</div>
                <h3>Error Loading Event</h3>
                <p>There was an error loading this event. Please try again later.</p>
            </div>`;
    }
};

window.addEventListener('auth-ready-no-user', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const inviteId = urlParams.get('invite');
    if (inviteId) {
        window.loadInvitation(inviteId);
    } else {
        showPage('homePage');
    }
});
</script>

<script>
// ‚îÄ‚îÄ‚îÄ GLOBAL STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let events = [];
let expenses = [];
let guests = [];
let currentEventId = null;
let currentGuestEventId = null;
let editingEventId = null;
let venueSearchTimeout = null;
let currentEventImageData = null;

// ‚îÄ‚îÄ‚îÄ THEME ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    
    document.getElementById('lightThemeBtn').classList.remove('active');
    document.getElementById('darkThemeBtn').classList.remove('active');
    
    if (theme === 'light') {
        document.getElementById('lightThemeBtn').classList.add('active');
    } else {
        document.getElementById('darkThemeBtn').classList.add('active');
    }
}
window.setTheme = setTheme;

// ‚îÄ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchAuthTab(tab, btn) {
    document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('signupForm').style.display = tab === 'signup' ? 'block' : 'none';
    document.getElementById('loginForm').style.display  = tab === 'login'  ? 'block' : 'none';
}
window.switchAuthTab = switchAuthTab;

async function signInWithGoogle() {
    try {
        const result = await window.signInWithPopup(window.auth, window.googleProvider);
        window.currentUser = result.user;
        const userDoc = await window.firestoreGetDoc(window.firestoreDoc(window.db, 'users', result.user.uid));
        if (!userDoc.exists() || !userDoc.data().username) { showPage('onboardingPage'); }
        else { await loadUserData(); showPage('dashboardPage'); }
    } catch (err) { alert('Error signing in with Google: ' + err.message); }
}
window.signInWithGoogle = signInWithGoogle;

async function signUpWithEmail() {
    const email = document.getElementById('signupEmail').value;
    const password = document.getElementById('signupPassword').value;
    try {
        const result = await window.createUserWithEmailAndPassword(window.auth, email, password);
        window.currentUser = result.user;
        await window.sendEmailVerification(result.user);
        alert('Verification email sent! Please check your inbox.');
        showPage('onboardingPage');
    } catch (err) { alert('Error creating account: ' + err.message); }
}
window.signUpWithEmail = signUpWithEmail;

async function loginWithEmail() {
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    try {
        const result = await window.signInWithEmailAndPassword(window.auth, email, password);
        window.currentUser = result.user;
        const userDoc = await window.firestoreGetDoc(window.firestoreDoc(window.db, 'users', result.user.uid));
        if (!userDoc.exists() || !userDoc.data().username) { showPage('onboardingPage'); }
        else { await loadUserData(); showPage('dashboardPage'); }
    } catch (err) { alert('Error signing in: ' + err.message); }
}
window.loginWithEmail = loginWithEmail;

async function logout() {
    try { await window.signOut(window.auth); window.currentUser = null; showPage('homePage'); }
    catch (err) { alert('Error signing out: ' + err.message); }
}
window.logout = logout;

// ‚îÄ‚îÄ‚îÄ ONBOARDING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function selectRadio(element, name) {
    document.querySelectorAll(`input[name="${name}"]`).forEach(r => r.parentElement.classList.remove('selected'));
    element.classList.add('selected');
    element.querySelector('input').checked = true;
}
window.selectRadio = selectRadio;

function nextOnboardingStep() {
    if (!document.querySelector('input[name="source"]:checked')) { alert('Please select an option'); return; }
    document.getElementById('onboardingStep1').classList.remove('active');
    document.getElementById('onboardingStep2').classList.add('active');
    document.getElementById('progressFill').style.width = '100%';
}
window.nextOnboardingStep = nextOnboardingStep;

async function completeOnboarding() {
    const username = document.getElementById('username').value.trim().toLowerCase();
    const displayName = document.getElementById('displayName').value.trim();
    if (!username || !displayName) { alert('Please fill in all fields'); return; }
    
    const usernameQuery = window.firestoreQuery(
        window.firestoreCollection(window.db, 'users'),
        window.firestoreWhere('username', '==', username)
    );
    const existingUsers = await window.firestoreGetDocs(usernameQuery);
    
    if (!existingUsers.empty) {
        alert('This username is already taken. Please choose a different one.');
        return;
    }
    
    const source = document.querySelector('input[name="source"]:checked').value;
    window.firestoreSetDoc(window.firestoreDoc(window.db, 'users', window.currentUser.uid), {
        username, displayName, source,
        email: window.currentUser.email,
        createdAt: new Date().toISOString()
    }).then(() => { loadUserData(); showPage('dashboardPage'); })
      .catch(err => alert('Error saving user data: ' + err.message));
}
window.completeOnboarding = completeOnboarding;

// ‚îÄ‚îÄ‚îÄ SETTINGS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function updateProfile() {
    const newUsername = document.getElementById('settingsUsername').value.trim().toLowerCase();
    const newDisplayName = document.getElementById('settingsDisplayName').value.trim();
    const errorDiv = document.getElementById('settingsError');
    const successDiv = document.getElementById('settingsSuccess');
    
    errorDiv.classList.remove('show');
    successDiv.classList.remove('show');
    
    if (!newUsername || !newDisplayName) {
        errorDiv.textContent = 'Please fill in all fields';
        errorDiv.classList.add('show');
        return;
    }
    
    try {
        const currentUserDoc = await window.firestoreGetDoc(window.firestoreDoc(window.db, 'users', window.currentUser.uid));
        const currentData = currentUserDoc.data();
        
        if (newUsername !== currentData.username) {
            const usernameQuery = window.firestoreQuery(
                window.firestoreCollection(window.db, 'users'),
                window.firestoreWhere('username', '==', newUsername)
            );
            const existingUsers = await window.firestoreGetDocs(usernameQuery);
            
            if (!existingUsers.empty) {
                errorDiv.textContent = 'This username is already taken. Please choose a different one.';
                errorDiv.classList.add('show');
                return;
            }
        }
        
        await window.firestoreUpdateDoc(window.firestoreDoc(window.db, 'users', window.currentUser.uid), {
            username: newUsername,
            displayName: newDisplayName,
            updatedAt: new Date().toISOString()
        });
        
        successDiv.textContent = 'Profile updated successfully!';
        successDiv.classList.add('show');
        
        document.getElementById('userDisplayName').textContent = newDisplayName;
        document.getElementById('userUsername').textContent = '@' + newUsername;
        document.getElementById('userAvatar').textContent = newDisplayName[0].toUpperCase();
        
    } catch (err) {
        errorDiv.textContent = 'Error updating profile: ' + err.message;
        errorDiv.classList.add('show');
    }
}
window.updateProfile = updateProfile;

// ‚îÄ‚îÄ‚îÄ LOAD USER DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadUserData() {
    if (!window.currentUser) return;
    try {
        const userDoc = await window.firestoreGetDoc(window.firestoreDoc(window.db, 'users', window.currentUser.uid));
        if (userDoc.exists()) {
            const u = userDoc.data();
            document.getElementById('userDisplayName').textContent = u.displayName || 'User';
            document.getElementById('userUsername').textContent = '@' + (u.username || 'user');
            document.getElementById('userAvatar').textContent = (u.displayName || 'U')[0].toUpperCase();
            
            document.getElementById('settingsUsername').value = u.username || '';
            document.getElementById('settingsDisplayName').value = u.displayName || '';
        }
        window.firestoreOnSnapshot(
            window.firestoreQuery(window.firestoreCollection(window.db, 'events'), window.firestoreWhere('userId', '==', window.currentUser.uid)),
            (snap) => {
                events = [];
                snap.forEach(doc => events.push({ id: doc.id, ...doc.data() }));
                renderEvents();
                updateEventSelects();
            }
        );
        window.firestoreOnSnapshot(
            window.firestoreQuery(window.firestoreCollection(window.db, 'expenses'), window.firestoreWhere('userId', '==', window.currentUser.uid)),
            (snap) => {
                expenses = [];
                snap.forEach(doc => expenses.push({ id: doc.id, ...doc.data() }));
                if (currentEventId) loadBudgetData();
            }
        );
        window.firestoreOnSnapshot(
            window.firestoreQuery(window.firestoreCollection(window.db, 'guests'), window.firestoreWhere('userId', '==', window.currentUser.uid)),
            (snap) => {
                guests = [];
                snap.forEach(doc => guests.push({ id: doc.id, ...doc.data() }));
                if (currentGuestEventId) loadGuestList();
            }
        );
    } catch (err) { console.error('Error loading user data:', err); }
}
window.loadUserData = loadUserData;

// ‚îÄ‚îÄ‚îÄ TABS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchTab(tab, clickedEl) {
    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
    clickedEl.closest('.nav-item').classList.add('active');
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    if (tab === 'events') document.getElementById('eventsTab').classList.add('active');
    else if (tab === 'guests') document.getElementById('guestsTab').classList.add('active');
    else if (tab === 'budget') document.getElementById('budgetTab').classList.add('active');
    else if (tab === 'settings') document.getElementById('settingsTab').classList.add('active');
}
window.switchTab = switchTab;

// ‚îÄ‚îÄ‚îÄ GUEST LIST MODE TOGGLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchGuestMode(mode, btn) {
    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.guest-mode').forEach(m => m.classList.remove('active'));
    if (mode === 'oneByOne') {
        document.getElementById('oneByOneMode').classList.add('active');
    } else {
        document.getElementById('spreadsheetMode').classList.add('active');
        initializeSpreadsheet();
    }
}
window.switchGuestMode = switchGuestMode;

// ‚îÄ‚îÄ‚îÄ SPREADSHEET FUNCTIONALITY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initializeSpreadsheet() {
    const tbody = document.getElementById('spreadsheetBody');
    if (tbody.children.length === 0) {
        for (let i = 0; i < 10; i++) {
            addSpreadsheetRow();
        }
    }
}

function addSpreadsheetRow() {
    const tbody = document.getElementById('spreadsheetBody');
    const row = document.createElement('tr');
    row.innerHTML = `
        <td><input type="text" placeholder="Guest name"></td>
        <td><input type="email" placeholder="email@example.com"></td>
        <td><input type="tel" placeholder="+1234567890"></td>
        <td>
            <select style="width:100%;padding:12px;border:none;background:transparent;font-family:'Epilogue',sans-serif;color:var(--text-primary);">
                <option value="Pending">Pending</option>
                <option value="Confirmed">Confirmed</option>
                <option value="Declined">Declined</option>
            </select>
        </td>
    `;
    tbody.appendChild(row);
}
window.addSpreadsheetRow = addSpreadsheetRow;

function clearSpreadsheet() {
    if (!confirm('Clear all rows in the spreadsheet?')) return;
    document.getElementById('spreadsheetBody').innerHTML = '';
    for (let i = 0; i < 10; i++) {
        addSpreadsheetRow();
    }
}
window.clearSpreadsheet = clearSpreadsheet;

async function importSpreadsheetGuests() {
    if (!currentGuestEventId) {
        alert('Please select an event first');
        return;
    }
    
    const rows = document.getElementById('spreadsheetBody').querySelectorAll('tr');
    let importedCount = 0;
    let errorCount = 0;
    
    for (const row of rows) {
        const inputs = row.querySelectorAll('input, select');
        const name = inputs[0].value.trim();
        const email = inputs[1].value.trim();
        const phone = inputs[2].value.trim();
        const rsvp = inputs[3].value;
        
        if (name) {
            try {
                // FIXED: Properly create document reference with auto-generated ID
                const guestsCollection = window.firestoreCollection(window.db, 'guests');
                const newGuestRef = window.firestoreDoc(guestsCollection);
                
                await window.firestoreSetDoc(newGuestRef, {
                    eventId: currentGuestEventId,
                    name: name,
                    email: email || '',
                    phone: phone || '',
                    rsvp: rsvp,
                    userId: window.currentUser.uid,
                    createdAt: new Date().toISOString()
                });
                importedCount++;
            } catch (err) {
                console.error('Error importing guest:', err);
                errorCount++;
            }
        }
    }
    
    if (importedCount > 0) {
        alert(`Successfully imported ${importedCount} guest(s)!${errorCount > 0 ? ` (${errorCount} failed)` : ''}`);
        clearSpreadsheet();
    } else {
        alert('No guests to import. Please fill in at least the name field.');
    }
}
window.importSpreadsheetGuests = importSpreadsheetGuests;

// ‚îÄ‚îÄ‚îÄ GUEST LIST MANAGEMENT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function loadGuestList() {
    const sel = document.getElementById('guestEventSelect').value;
    if (!sel) {
        document.getElementById('guestContent').style.display = 'none';
        document.getElementById('emptyGuestState').style.display = 'block';
        return;
    }
    
    currentGuestEventId = sel;
    document.getElementById('guestContent').style.display = 'block';
    document.getElementById('emptyGuestState').style.display = 'none';
    
    renderGuestList();
}
window.loadGuestList = loadGuestList;

function renderGuestList() {
    const eventGuests = guests.filter(g => g.eventId === currentGuestEventId);
    
    // Render for One by One mode
    const tbody = document.getElementById('guestsTableBody');
    if (!eventGuests.length) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:40px;color:var(--text-secondary);">No guests yet</td></tr>';
    } else {
        tbody.innerHTML = eventGuests.map(g => `
            <tr class="table-row-hover">
                <td><strong>${g.name}</strong></td>
                <td>${g.email || '-'}</td>
                <td>${g.phone || '-'}</td>
                <td><span style="padding:4px 12px;background:${getRSVPColor(g.rsvp)};border-radius:12px;font-size:12px;font-weight:600;">${g.rsvp}</span></td>
                <td><button class="btn-small btn-outline" onclick="deleteGuest('${g.id}')">Delete</button></td>
            </tr>
        `).join('');
    }
    
    // Render for Spreadsheet mode
    const tbody2 = document.getElementById('spreadsheetGuestsTableBody');
    if (!eventGuests.length) {
        tbody2.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:40px;color:var(--text-secondary);">No guests yet</td></tr>';
    } else {
        tbody2.innerHTML = eventGuests.map(g => `
            <tr class="table-row-hover">
                <td><strong>${g.name}</strong></td>
                <td>${g.email || '-'}</td>
                <td>${g.phone || '-'}</td>
                <td><span style="padding:4px 12px;background:${getRSVPColor(g.rsvp)};border-radius:12px;font-size:12px;font-weight:600;">${g.rsvp}</span></td>
                <td><button class="btn-small btn-outline" onclick="deleteGuest('${g.id}')">Delete</button></td>
            </tr>
        `).join('');
    }
}

function getRSVPColor(rsvp) {
    if (rsvp === 'Confirmed') return '#d1fae5';
    if (rsvp === 'Declined') return '#fee2e2';
    return '#e0e7ff';
}

async function saveGuest(e) {
    e.preventDefault();
    
    if (!currentGuestEventId) {
        alert('Please select an event first');
        return;
    }
    
    try {
        await window.firestoreSetDoc(
            window.firestoreDoc(window.firestoreCollection(window.db, 'guests')),
            {
                eventId: currentGuestEventId,
                name: document.getElementById('guestName').value,
                email: document.getElementById('guestEmail').value,
                phone: document.getElementById('guestPhone').value,
                rsvp: document.getElementById('guestRSVP').value,
                userId: window.currentUser.uid,
                createdAt: new Date().toISOString()
            }
        );
        
        closeModal('guestModal');
        document.getElementById('guestName').value = '';
        document.getElementById('guestEmail').value = '';
        document.getElementById('guestPhone').value = '';
        document.getElementById('guestRSVP').value = 'Pending';
    } catch (err) {
        alert('Error adding guest: ' + err.message);
    }
}
window.saveGuest = saveGuest;

function deleteGuest(id) {
    if (!confirm('Delete this guest?')) return;
    window.firestoreDeleteDoc(window.firestoreDoc(window.db, 'guests', id))
        .catch(err => alert('Error deleting guest: ' + err.message));
}
window.deleteGuest = deleteGuest;

// ‚îÄ‚îÄ‚îÄ IMAGE UPLOAD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function handleImageSelect(evt) {
    const file = evt.target.files[0];
    if (!file) return;
    if (file.size > 1 * 1024 * 1024) { alert('Image must be less than 1 MB.'); evt.target.value = ''; return; }
    if (!file.type.startsWith('image/')) { alert('Please select an image file.'); return; }

    const reader = new FileReader();
    reader.onload = function(e) {
        currentEventImageData = e.target.result;
        document.getElementById('previewImg').src = currentEventImageData;
        document.getElementById('uploadArea').style.display = 'none';
        document.getElementById('imagePreview').classList.add('active');
    };
    reader.readAsDataURL(file);
}
window.handleImageSelect = handleImageSelect;

function removeImage() {
    currentEventImageData = null;
    document.getElementById('eventImageInput').value = '';
    document.getElementById('previewImg').src = '';
    document.getElementById('uploadArea').style.display = 'block';
    document.getElementById('imagePreview').classList.remove('active');
}
window.removeImage = removeImage;

// ‚îÄ‚îÄ‚îÄ VENUE AUTOCOMPLETE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setupVenueAutocomplete() {
    const input = document.getElementById('eventVenue');
    const dropdown = document.getElementById('venueAutocomplete');
    if (!input || !dropdown) return;
    const clone = input.cloneNode(true);
    input.parentNode.replaceChild(clone, input);

    clone.addEventListener('input', function() {
        const q = this.value.trim();
        if (venueSearchTimeout) clearTimeout(venueSearchTimeout);
        if (q.length < 3) { dropdown.classList.remove('active'); return; }
        dropdown.innerHTML = '<div class="autocomplete-loading">Searching...</div>';
        dropdown.classList.add('active');
        venueSearchTimeout = setTimeout(() => searchVenues(q, dropdown), 400);
    });

    document.addEventListener('click', function(e) {
        if (!clone.contains(e.target) && !dropdown.contains(e.target)) dropdown.classList.remove('active');
    });
}
window.setupVenueAutocomplete = setupVenueAutocomplete;

async function searchVenues(q, dropdown) {
    try {
        const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}&limit=5&addressdetails=1`, { headers: { 'Accept': 'application/json' } });
        const results = await res.json();
        if (!results.length) { dropdown.innerHTML = '<div class="autocomplete-loading">No results found</div>'; return; }
        dropdown.innerHTML = results.map(place => {
            const name = place.name || place.display_name.split(',')[0];
            return `<div class="autocomplete-item" onclick="selectVenue('${place.display_name.replace(/'/g, "&#39;")}','${place.lat}','${place.lon}','${name.replace(/'/g, "&#39;")}')">
                <div class="autocomplete-icon">üìç</div>
                <div class="autocomplete-text">
                    <div class="autocomplete-name">${name}</div>
                    <div class="autocomplete-address">${place.display_name}</div>
                </div></div>`;
        }).join('');
    } catch (err) { dropdown.innerHTML = '<div class="autocomplete-loading">Error loading results</div>'; }
}
window.searchVenues = searchVenues;

function selectVenue(address, lat, lon, name) {
    const input = document.getElementById('eventVenue');
    input.value = address;
    input.setAttribute('data-lat', lat);
    input.setAttribute('data-lon', lon);
    input.setAttribute('data-name', name);
    const mapInput = document.getElementById('eventMapLink');
    if (!mapInput.value.trim()) {
        mapInput.value = `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`;
    }
    document.getElementById('venueAutocomplete').classList.remove('active');
}
window.selectVenue = selectVenue;

// ‚îÄ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openModal(modalId) {
    if (modalId === 'eventModal' && !editingEventId) resetEventForm();
    if (modalId === 'guestModal' && !currentGuestEventId) {
        alert('Please select an event first');
        return;
    }
    document.getElementById(modalId).classList.add('active');
    if (modalId === 'eventModal') setTimeout(setupVenueAutocomplete, 100);
}
window.openModal = openModal;

function closeModal(modalId) {
    document.getElementById(modalId).classList.remove('active');
    if (modalId === 'eventModal') { editingEventId = null; resetEventForm(); }
}
window.closeModal = closeModal;

function resetEventForm() {
    currentEventImageData = null;
    document.getElementById('eventImageInput').value = '';
    document.getElementById('previewImg').src = '';
    document.getElementById('uploadArea').style.display = 'block';
    document.getElementById('imagePreview').classList.remove('active');

    document.getElementById('eventModalTitle').textContent = 'Create Event';
    document.getElementById('eventName').value = '';
    document.getElementById('eventDate').value = '';
    document.getElementById('eventTime').value = '';
    document.getElementById('eventGuests').value = '';
    document.getElementById('eventVenue').value = '';
    document.getElementById('eventVenue').removeAttribute('data-lat');
    document.getElementById('eventVenue').removeAttribute('data-lon');
    document.getElementById('eventVenue').removeAttribute('data-name');
    document.getElementById('eventMapLink').value = '';
    document.getElementById('eventDescription').value = '';
    document.getElementById('eventId').value = '';
    document.getElementById('eventInvitation').style.display = 'none';
    document.getElementById('saveEventBtn').textContent = 'Save Event';
}

// ‚îÄ‚îÄ‚îÄ SAVE EVENT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function saveEvent(e) {
    e.preventDefault();
    document.getElementById('saveEventBtn').textContent = 'Saving...';

    const venueInput = document.getElementById('eventVenue');
    const venue = venueInput.value;
    const venueLat = venueInput.getAttribute('data-lat');
    const venueLon = venueInput.getAttribute('data-lon');
    const venueName = venueInput.getAttribute('data-name');
    const userMapLink = document.getElementById('eventMapLink').value.trim();

    let venueMapLink = '';
    if (userMapLink) venueMapLink = userMapLink;
    else if (venueLat && venueLon) venueMapLink = `https://www.google.com/maps/search/?api=1&query=${venueLat},${venueLon}`;
    else if (venue) venueMapLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(venue)}`;

    const eventData = {
        name: document.getElementById('eventName').value,
        date: document.getElementById('eventDate').value,
        time: document.getElementById('eventTime').value,
        guests: document.getElementById('eventGuests').value,
        venue, venueMapLink,
        venueLat: venueLat || null,
        venueLon: venueLon || null,
        venueName: venueName || null,
        description: document.getElementById('eventDescription').value,
        userId: window.currentUser.uid,
        updatedAt: new Date().toISOString()
    };

    eventData.imageUrl = currentEventImageData || null;

    try {
        if (editingEventId) {
            await window.firestoreUpdateDoc(window.firestoreDoc(window.db, 'events', editingEventId), eventData);
        } else {
            eventData.createdAt = new Date().toISOString();
            const newRef = window.firestoreDoc(window.firestoreCollection(window.db, 'events'));
            await window.firestoreSetDoc(newRef, eventData);
        }
        closeModal('eventModal');
    } catch (err) {
        alert('Error saving event: ' + err.message);
        document.getElementById('saveEventBtn').textContent = 'Save Event';
    }
}
window.saveEvent = saveEvent;

// ‚îÄ‚îÄ‚îÄ EDIT EVENT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function editEvent(id) {
    const evt = events.find(e => e.id === id);
    if (!evt) return;

    resetEventForm();
    editingEventId = id;

    document.getElementById('eventModalTitle').textContent = 'Edit Event';
    document.getElementById('eventName').value = evt.name || '';
    document.getElementById('eventDate').value = evt.date || '';
    document.getElementById('eventTime').value = evt.time || '';
    document.getElementById('eventGuests').value = evt.guests || '';
    document.getElementById('eventVenue').value = evt.venue || '';
    if (evt.venueLat) document.getElementById('eventVenue').setAttribute('data-lat', evt.venueLat);
    if (evt.venueLon) document.getElementById('eventVenue').setAttribute('data-lon', evt.venueLon);
    if (evt.venueName) document.getElementById('eventVenue').setAttribute('data-name', evt.venueName);
    document.getElementById('eventMapLink').value = evt.venueMapLink || '';
    document.getElementById('eventDescription').value = evt.description || '';

    if (evt.imageUrl) {
        currentEventImageData = evt.imageUrl;
        document.getElementById('previewImg').src = evt.imageUrl;
        document.getElementById('uploadArea').style.display = 'none';
        document.getElementById('imagePreview').classList.add('active');
    }

    openModal('eventModal');
}
window.editEvent = editEvent;

// ‚îÄ‚îÄ‚îÄ DELETE EVENT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function deleteEvent(id) {
    if (!confirm('Are you sure you want to delete this event?')) return;
    window.firestoreDeleteDoc(window.firestoreDoc(window.db, 'events', id))
        .then(() => {
            const toDelete = expenses.filter(e => e.eventId === id);
            const guestsToDelete = guests.filter(g => g.eventId === id);
            return Promise.all([
                ...toDelete.map(ex => window.firestoreDeleteDoc(window.firestoreDoc(window.db, 'expenses', ex.id))),
                ...guestsToDelete.map(g => window.firestoreDeleteDoc(window.firestoreDoc(window.db, 'guests', g.id)))
            ]);
        })
        .catch(err => alert('Error deleting event: ' + err.message));
}
window.deleteEvent = deleteEvent;

// ‚îÄ‚îÄ‚îÄ SHARE / INVITATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function viewInvitation(id) {
    const evt = events.find(e => e.id === id);
    if (!evt) return;

    resetEventForm();
    editingEventId = id;

    document.getElementById('eventModalTitle').textContent = 'Share Event';
    document.getElementById('eventName').value = evt.name || '';
    document.getElementById('eventDate').value = evt.date || '';
    document.getElementById('eventTime').value = evt.time || '';
    document.getElementById('eventGuests').value = evt.guests || '';
    document.getElementById('eventVenue').value = evt.venue || '';
    document.getElementById('eventMapLink').value = evt.venueMapLink || '';
    document.getElementById('eventDescription').value = evt.description || '';

    if (evt.imageUrl) {
        currentEventImageData = evt.imageUrl;
        document.getElementById('previewImg').src = evt.imageUrl;
        document.getElementById('uploadArea').style.display = 'none';
        document.getElementById('imagePreview').classList.add('active');
    }

    const baseUrl = window.location.origin + window.location.pathname;
    document.getElementById('invitationLink').value = `${baseUrl}?invite=${evt.id}`;
    document.getElementById('eventInvitation').style.display = 'block';

    openModal('eventModal');
}
window.viewInvitation = viewInvitation;

function copyInvitation(btn) {
    const link = document.getElementById('invitationLink');
    link.select();
    document.execCommand('copy');
    btn.textContent = 'Copied!';
    setTimeout(() => { btn.textContent = 'Copy'; }, 2000);
}
window.copyInvitation = copyInvitation;

// ‚îÄ‚îÄ‚îÄ RENDER INVITATION PAGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderInvitation(evt) {
    const date = new Date(evt.date);
    const formattedDate = date.toLocaleDateString('en-US', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
    const displayVenue = evt.venueName || evt.venue || 'Location TBD';
    const mapLink = evt.venueMapLink || '';

    let mapBtn = '';
    if (mapLink) {
        mapBtn = `<a href="${mapLink}" target="_blank" rel="noopener noreferrer"
            style="display:inline-flex;align-items:center;gap:8px;padding:12px 20px;
            background:linear-gradient(to right,#4f46e5,#7c3aed);color:white;
            text-decoration:none;border-radius:8px;font-weight:600;font-size:14px;
            box-shadow:0 4px 6px rgba(79,70,229,0.3);">
            <span style="font-size:16px;">üìç</span><span>Open in Google Maps</span><span style="font-size:12px;">‚Üó</span></a>`;
    }

    let imgHtml = '';
    if (evt.imageUrl) {
        imgHtml = `<img src="${evt.imageUrl}" alt="${evt.name}" class="invitation-image">`;
    }

    document.getElementById('invitationContent').innerHTML = `
        ${imgHtml}
        <div style="text-align:center;margin-bottom:32px;">
            <h1 style="font-size:32px;font-weight:800;color:var(--text-primary);">${evt.name}</h1>
        </div>
        <div style="background:var(--accent-light);border-radius:12px;padding:24px;margin-bottom:24px;">
            <div style="display:flex;flex-direction:column;gap:16px;">
                <div style="display:flex;align-items:center;gap:12px;">
                    <span style="font-size:24px;">üìÖ</span>
                    <div>
                        <div style="font-size:14px;color:var(--text-secondary);font-weight:600;">DATE & TIME</div>
                        <div style="font-size:16px;color:var(--text-primary);font-weight:600;">${formattedDate}</div>
                        <div style="font-size:15px;color:var(--text-secondary);">${evt.time}</div>
                    </div>
                </div>
                ${evt.venue ? `
                <div style="display:flex;align-items:start;gap:12px;">
                    <span style="font-size:24px;">üìç</span>
                    <div style="flex:1;">
                        <div style="font-size:14px;color:var(--text-secondary);font-weight:600;margin-bottom:6px;">LOCATION</div>
                        <div style="font-size:15px;color:var(--text-primary);margin-bottom:12px;font-weight:500;line-height:1.4;">${displayVenue}</div>
                        ${mapBtn}
                    </div>
                </div>` : ''}
            </div>
        </div>
        ${evt.description ? `
        <div style="margin-bottom:24px;">
            <h3 style="font-size:16px;font-weight:700;color:var(--text-primary);margin-bottom:12px;">About this Event</h3>
            <p style="font-size:15px;color:var(--text-secondary);line-height:1.6;">${evt.description}</p>
        </div>` : ''}
        <div style="background:var(--accent-light);border-radius:12px;padding:20px;text-align:center;">
            <p style="font-size:14px;color:var(--gradient-start);font-weight:600;margin:0;">üéâ We look forward to seeing you there!</p>
        </div>`;
}
window.renderInvitation = renderInvitation;

// ‚îÄ‚îÄ‚îÄ RENDER EVENTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderEvents() {
    const grid = document.getElementById('eventsGrid');
    const empty = document.getElementById('emptyEventsState');
    if (!events.length) { grid.style.display = 'none'; empty.style.display = 'block'; return; }
    grid.style.display = 'grid'; empty.style.display = 'none';
    grid.innerHTML = events.map(buildEventCard).join('');
}

function buildEventCard(evt) {
    const d = new Date(evt.date);
    const fd = d.toLocaleDateString('en-US', { month:'short', day:'numeric', year:'numeric' });
    const imgHtml = evt.imageUrl ? `<img src="${evt.imageUrl}" alt="${evt.name}" class="event-image">` : '';
    return `<div class="event-card glass-card">
        ${imgHtml}
        <div class="event-header"><h3>${evt.name}</h3></div>
        <div class="event-meta">
            <div class="event-meta-item"><span>üìÖ</span><span>${fd} at ${evt.time}</span></div>
            <div class="event-meta-item"><span>üë•</span><span>${evt.guests || 'Unknown'} guests</span></div>
            ${evt.venue ? `<div class="event-meta-item"><span>üìç</span><span>${evt.venueName || evt.venue}</span></div>` : ''}
            ${evt.venueMapLink ? `<div class="event-meta-item" style="margin-left:32px;"><a href="${evt.venueMapLink}" target="_blank" style="color:var(--gradient-start);text-decoration:none;font-weight:600;font-size:13px;">View on Google Maps ‚Üí</a></div>` : ''}
        </div>
        ${evt.description ? `<p style="font-size:14px;color:var(--text-secondary);margin-bottom:16px;">${evt.description}</p>` : ''}
        <div class="event-footer">
            <button class="btn-small btn-outline" onclick="editEvent('${evt.id}')">Edit</button>
            <button class="btn-small btn-outline" onclick="deleteEvent('${evt.id}')">Delete</button>
            <button class="btn-small btn-gradient" onclick="viewInvitation('${evt.id}')">Share</button>
        </div>
    </div>`;
}

function searchEvents() {
    const q = document.getElementById('searchEvents').value.toLowerCase();
    const filtered = events.filter(e => e.name.toLowerCase().includes(q) || (e.venue && e.venue.toLowerCase().includes(q)));
    const grid = document.getElementById('eventsGrid');
    grid.innerHTML = filtered.length ? filtered.map(buildEventCard).join('') : '<div class="empty-state"><p>No events found</p></div>';
}
window.searchEvents = searchEvents;

// ‚îÄ‚îÄ‚îÄ BUDGET & EXPENSES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateEventSelects() {
    const opts = events.map(e => `<option value="${e.id}">${e.name}</option>`).join('');
    document.getElementById('budgetEventSelect').innerHTML = '<option value="">Choose an event...</option>' + opts;
    document.getElementById('expenseEventSelect').innerHTML = '<option value="">Select an event...</option>' + opts;
    document.getElementById('guestEventSelect').innerHTML = '<option value="">Choose an event...</option>' + opts;
}

function loadBudgetData() {
    const sel = document.getElementById('budgetEventSelect').value;
    if (!sel) { document.getElementById('budgetContent').style.display='none'; document.getElementById('emptyBudgetState').style.display='block'; return; }
    currentEventId = sel;
    document.getElementById('budgetContent').style.display = 'block';
    document.getElementById('emptyBudgetState').style.display = 'none';

    const evt = events.find(e => e.id === sel);
    const evtExpenses = expenses.filter(e => e.eventId === sel);
    const totalExp = evtExpenses.reduce((s, ex) => s + (parseFloat(ex.amount)||0)*(parseFloat(ex.price)||0), 0);
    const totalBud = parseFloat(evt.budget) || 0;
    const rem = totalBud - totalExp;

    document.getElementById('totalBudget').textContent = '$' + totalBud.toFixed(2);
    document.getElementById('totalExpenses').textContent = '$' + totalExp.toFixed(2);
    const remEl = document.getElementById('remaining');
    remEl.textContent = '$' + rem.toFixed(2);
    remEl.className = 'budget-stat-value ' + (rem > 0 ? 'positive' : rem < 0 ? 'negative' : 'neutral');

    renderExpenses(evtExpenses);
}
window.loadBudgetData = loadBudgetData;

function renderExpenses(arr) {
    const tbody = document.getElementById('expensesTableBody');
    if (!arr.length) { tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:var(--text-secondary);">No expenses yet</td></tr>'; return; }
    tbody.innerHTML = arr.map(ex => {
        const a = parseFloat(ex.amount)||0, p = parseFloat(ex.price)||0;
        return `<tr class="table-row-hover">
            <td><strong>${ex.name}</strong></td><td>${ex.category||'-'}</td>
            <td>${a}</td><td>$${p.toFixed(2)}</td><td><strong>$${(a*p).toFixed(2)}</strong></td>
            <td><button class="btn-small btn-outline" onclick="deleteExpense('${ex.id}')">Delete</button></td>
        </tr>`;
    }).join('');
}

function saveExpense(e) {
    e.preventDefault();
    window.firestoreSetDoc(
        window.firestoreDoc(window.firestoreCollection(window.db, 'expenses')),
        {
            eventId: document.getElementById('expenseEventSelect').value,
            name: document.getElementById('expenseName').value,
            category: document.getElementById('expenseCategory').value,
            amount: document.getElementById('expenseAmount').value,
            price: document.getElementById('expensePrice').value,
            budget: document.getElementById('expenseBudget').value,
            userId: window.currentUser.uid,
            createdAt: new Date().toISOString()
        }
    ).then(() => {
        closeModal('expenseModal');
        document.getElementById('expenseName').value = '';
        document.getElementById('expenseCategory').value = '';
        document.getElementById('expenseAmount').value = '';
        document.getElementById('expensePrice').value = '';
        document.getElementById('expenseBudget').value = '';
        document.getElementById('expenseEventSelect').value = '';
    }).catch(err => alert('Error creating expense: ' + err.message));
}
window.saveExpense = saveExpense;

function deleteExpense(id) {
    if (!confirm('Delete this expense?')) return;
    window.firestoreDeleteDoc(window.firestoreDoc(window.db, 'expenses', id))
        .catch(err => alert('Error deleting expense: ' + err.message));
}
window.deleteExpense = deleteExpense;

function setEventBudget(e) {
    e.preventDefault();
    if (!currentEventId) { alert('Please select an event first'); return; }
    window.firestoreUpdateDoc(window.firestoreDoc(window.db, 'events', currentEventId), {
        budget: document.getElementById('eventBudgetAmount').value,
        updatedAt: new Date().toISOString()
    }).then(() => { closeModal('setBudgetModal'); document.getElementById('eventBudgetAmount').value=''; loadBudgetData(); })
      .catch(err => alert('Error setting budget: ' + err.message));
}
window.setEventBudget = setEventBudget;

// ‚îÄ‚îÄ‚îÄ CLOSE MODAL ON BACKDROP CLICK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.querySelectorAll('.modal').forEach(modal => {
    modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.remove('active'); });
});
</script>
</body>
</html>

